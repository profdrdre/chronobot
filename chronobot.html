<!DOCTYPE html>
<html>
<head>
    <script src="https://pixijs.download/release/pixi.min.js"></script>
    <script src="numbertokens.js"></script>
    <script src="workertokens.js"></script>

</head>
<body>
<canvas id="mycanvas"></canvas>
<script>
    const global_scaling = 3/4,
    global_steps = 30;

    class Board extends PIXI.Sprite {

        constructor(texture) {
            super(texture);
        }

        validateWorkers(){
            if (scientistToken.number>0 && engineerToken.number>0 && adminToken.number>0 && geniusToken.number>0){
                scientistToken.remove();
                engineerToken.remove();
                adminToken.remove();
                geniusToken.remove();
            }
        }


    }

    const canvas = document.getElementById('mycanvas');

    const automa = new PIXI.Application({
        view: canvas,
        width: 1482 * global_scaling,
        height: 1080 * global_scaling,
        resolution: 1,
        autoDensity: true
    });

    automa.stage.scale.x=global_scaling;
    automa.stage.scale.y=global_scaling;

    //  the board

    const board_texture = PIXI.Texture.from('images/board.png');
    const board = new Board(board_texture);
    board.x= 0 ;
    board.y = 0;
    automa.stage.addChild(board);

    // number tokens + their states

    const states = {};
    const statePos = [{x: 95, y:112},{x: 254, y:112},{x: 415, y:112},
        {x: 95, y:464},{x: 255, y:464},{x: 415, y:464},{x: 573, y:464},
        {x: 415, y:625},{x: 255, y:625},{x: 95, y:625}, {x:573, y: 625},
        {x: 95, y:848},{x: 255, y:848}];

    const stateTransition = {1:2, 2:3, 3:1,4:5, 5:6, 6:7, 7:8, 8:9, 9:10, 10:4,11:8,12:13, 13:12};
    const stateStart = [1,5,7,8,11,12];


    for (let i = 1; i<=13; i++) {
        states[i]= new State(i, statePos[i-1]);
    }
    for (const [key, value] of Object.entries(states)) {
        value.setNext(states[stateTransition[key]])
    }

    const tokens = [];
    for(let i=1;i<=6;i++){
        const newToken = new Token(i, PIXI.Texture.from('images/t'+i.toString()+'.png'), states[stateStart[i-1]]);
        tokens.push(newToken);
        board.addChild(newToken);
    }

    // worker token

    const workerPositions = [{x:709, y:601}, {x:819, y:601},{x:929, y:601},{x:1037, y:601}]

    const genius_texture = PIXI.Texture.from('images/genius.png');
    const admin_texture = PIXI.Texture.from('images/admin.png');
    const engineer_texture = PIXI.Texture.from('images/engineer.png');
    const scientist_texture = PIXI.Texture.from('images/scientist.png');
    const geniusToken = new WorkerToken(genius_texture,workerPositions[0],0);
    const adminToken = new WorkerToken(admin_texture,workerPositions[1],0);
    const engineerToken = new WorkerToken(engineer_texture,workerPositions[2],0);
    const scientistToken = new WorkerToken(scientist_texture,workerPositions[3],0);

    board.addChild(geniusToken);
    board.addChild(adminToken);
    board.addChild(engineerToken);
    board.addChild(scientistToken);


</script>
</body>
</html>