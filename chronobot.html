<!DOCTYPE html>
<html>
<head>
    <script src="https://pixijs.download/release/pixi.min.js"></script>
    <script src="numbertokens.js"></script>
<!--    <script src="workertokens.js"></script>-->
    <script src="statictokens.js"></script>
    <script src="slidetokens.js"></script>

</head>
<body>
<canvas id="mycanvas"></canvas>
<script>
    const global_scaling = 3/4,
    global_steps = 30;

    class Board extends PIXI.Sprite {

        constructor(texture) {
            super(texture);
        }

        validateWorkers(){
            if (scientistToken.number>0 && engineerToken.number>0 && adminToken.number>0 && geniusToken.number>0){
                scientistToken.remove();
                engineerToken.remove();
                adminToken.remove();
                geniusToken.remove();
            }
        }

        validateResources(){
            if (neutroniumToken.number>0 && uraniumToken.number>0 && goldToken.number>0 && titaniumToken.number>0){
                neutroniumToken.remove();
                uraniumToken.remove();
                goldToken.remove();
                titaniumToken.remove();
            }
        }


    }

    const canvas = document.getElementById('mycanvas');

    const automa = new PIXI.Application({
        view: canvas,
        width: 1482 * global_scaling,
        height: 1080 * global_scaling,
        resolution: 1,
        autoDensity: true
    });

    automa.stage.scale.x=global_scaling;
    automa.stage.scale.y=global_scaling;

    //  the board

    const board_texture = PIXI.Texture.from('images/board.png');
    const board = new Board(board_texture);
    board.x= 0 ;
    board.y = 0;
    automa.stage.addChild(board);

    // number tokens + their states

    const states = {};
    const statePos = [{x: 95, y:112},{x: 254, y:112},{x: 415, y:112},
        {x: 95, y:464},{x: 255, y:464},{x: 415, y:464},{x: 573, y:464},
        {x: 415, y:625},{x: 255, y:625},{x: 95, y:625}, {x:573, y: 625},
        {x: 95, y:848},{x: 255, y:848}];

    const stateTransition = {1:2, 2:3, 3:1,4:5, 5:6, 6:7, 7:8, 8:9, 9:10, 10:4,11:8,12:13, 13:12};
    const stateStart = [1,5,7,8,11,12];


    for (let i = 1; i<=13; i++) {
        states[i]= new State(i, statePos[i-1]);
    }
    for (const [key, value] of Object.entries(states)) {
        value.setNext(states[stateTransition[key]])
    }

    const tokens = [];
    for(let i=1;i<=6;i++){
        const newToken = new Token(i, PIXI.Texture.from('images/t'+i.toString()+'.png'), states[stateStart[i-1]]);
        tokens.push(newToken);
        board.addChild(newToken);
    }

    // worker token

    const workerPositions = [{x:709, y:601}, {x:819, y:601},{x:929, y:601},{x:1037, y:601}]

    const genius_texture = PIXI.Texture.from('images/genius.png');
    const admin_texture = PIXI.Texture.from('images/admin.png');
    const engineer_texture = PIXI.Texture.from('images/engineer.png');
    const scientist_texture = PIXI.Texture.from('images/scientist.png');
    const geniusToken = new WorkerToken(genius_texture,workerPositions[0],0);
    const adminToken = new WorkerToken(admin_texture,workerPositions[1],0);
    const engineerToken = new WorkerToken(engineer_texture,workerPositions[2],0);
    const scientistToken = new WorkerToken(scientist_texture,workerPositions[3],0);

    board.addChild(geniusToken);
    board.addChild(adminToken);
    board.addChild(engineerToken);
    board.addChild(scientistToken);

    const resourcePositions = [{x:735, y:460}, {x:869, y:460},{x:1005, y:460},{x:1137, y:460}]
    const neutronium_texture = PIXI.Texture.from('images/neutronium.png');
    const uranium_texture = PIXI.Texture.from('images/uranium.png');
    const gold_texture = PIXI.Texture.from('images/gold.png');
    const titanium_texture = PIXI.Texture.from('images/titanium.png');
    const neutroniumToken = new ResourceToken(neutronium_texture,resourcePositions[0],0);
    const uraniumToken = new ResourceToken(uranium_texture,resourcePositions[1],0);
    const goldToken = new ResourceToken(gold_texture,resourcePositions[2],0);
    const titaniumToken = new ResourceToken(titanium_texture,resourcePositions[3],0);

    board.addChild(neutroniumToken);
    board.addChild(uraniumToken);
    board.addChild(goldToken);
    board.addChild(titaniumToken);

    const supplyPositions ={0:{x:743, y:350},1: {x:810, y:315},2:{x:878, y:315},3: {x:945, y:315}};
    const supplyTransitions ={0:1,1:2,2:3,3:3};
    const supplyToken = new SlideToken(PIXI.Texture.from('images/supply.png'),0, supplyPositions, supplyTransitions );

    const timetravelPositions ={0:{x:542, y:226},1: {x:608, y:191},2:{x:674, y:191},3: {x:742, y:191},
        4:{x:808, y:191},5: {x:876, y:191},6:{x:942, y:191}};
    const timetravelTransitions ={0:1,1:2,2:3,3:4, 4:5, 5:6, 6:6};
    const timetravelToken = new SlideToken(PIXI.Texture.from('images/timetravel.png'),0,
        timetravelPositions, timetravelTransitions );

    board.addChild(supplyToken);
    board.addChild(timetravelToken);


    const paradoxTokens = [];
    const paradoxPositions = [{x: 714, y:92},{x:864, y : 155},{x: 851, y:92}]


    for(let j=1;j<=3;j++){
        const newToken = new StaticToken(PIXI.Texture.from('images/paradox.png'),paradoxPositions[j-1], 0, false,1);
        if (j===2) newToken.angle= 180;
        paradoxTokens.push(newToken);
        board.addChild(newToken);
    }

    powerPlantBack = new StaticToken(PIXI.Texture.from('images/power.png'),{x: 750, y:859},0, true,3);
    powerPlantBack.text.position={x:85, y : 170};
    factoryBack = new StaticToken(PIXI.Texture.from('images/factories.png'),{x: 930, y:859}, 0, true,3);
    factoryBack.text.position={x:85, y : 170};
    habitatBack = new StaticToken(PIXI.Texture.from('images/habitats.png'),{x: 1108, y:859}, 0, true,3);
    habitatBack.text.position={x:85, y : 170};
    labBack = new StaticToken(PIXI.Texture.from('images/lab.png'),{x: 1286, y:859}, 0, true,3);
    labBack.text.position={x:85, y : 170};
    anomalyBack = new StaticToken(PIXI.Texture.from('images/anomaly.png'),{x: 1010, y:47}, 0, true,3);
    anomalyBack.text.position={x:85, y : 170};
    superProjectBack = new StaticToken(PIXI.Texture.from('images/superproject.png'),{x: 361, y:858}, 0, true,2);
    superProjectBack.text.position={x:175, y : 165};



    board.addChild(powerPlantBack);
    board.addChild(factoryBack);
    board.addChild(habitatBack);
    board.addChild(labBack);
    board.addChild(anomalyBack);
    board.addChild(superProjectBack);


</script>
</body>
</html>