<!DOCTYPE html>
<html>
<head>
    <script src="https://pixijs.download/release/pixi.min.js"></script>
</head>
<body>
<canvas id="mycanvas"></canvas>
<script>

    class Token extends PIXI.Sprite {

        constructor(texture, startState) {
            super(texture)
            console.log("sdf");
            this.on('pointerdown',this.tokenClicked)
            this.state = startState;
            this.steps = 30; // steps per animation

            this.target = {x: 0, y:0};
            this.delta = {x: 0, y:0};

            this.statePositions = {};
            this.stateTransitions = {};


            this.tokenMover = () => {
                this.x += this.delta.x;
                this.y += this.delta.y;
                if (Math.abs(this.target.x - this.x) < Math.abs(this.delta.x)) {
                    this.x = this.target.x;
                    this.y = this.target.y;
                    automa.ticker.remove(this.tokenMover);
                }
                //console.log("tick "+this.target.x.toString())
            }

        }

        setStatePositions(states, positions) {
            states.forEach((value,index)=>{ this.statePositions[value]= positions[index];})
        }

        setStateTransitions(transitions) {
            this.stateTransitions = transitions;
        }


        tokenClicked(){
            this.state = this.stateTransitions[this.state];
            this.target = this.statePositions[this.state];
            this.delta.x = ((this.target.x - this.x) / this.steps);
            this.delta.y = ((this.target.y - this.y) / this.steps);

            automa.ticker.add(this.tokenMover);

        }
    }

    const canvas = document.getElementById('mycanvas');

    const automa = new PIXI.Application({
        view: canvas,
        width: 1482,
        height: 1080,
        resolution: 1,
        autoDensity: true
    });

    const board_texture = PIXI.Texture.from('images/board.png');
    const board_img = new PIXI.Sprite(board_texture);
    board_img.x= 0 ;
    board_img.y = 0;
    automa.stage.addChild(board_img);

    const t1_texture = PIXI.Texture.from('images/t1.png');
    const t6_texture = PIXI.Texture.from('images/t6.png');
    const t1 = new Token(t1_texture, 1);
    const t6 = new Token(t6_texture, 12);



    t1.x = 48;
    t1.y = 64;
    t6.x = 48;
    t6.y = 800;

    // Opt-in to interactivity
    t1.interactive = true;
    t1.buttonMode = true;
    t6.interactive = true;
    t6.buttonMode = true;

    // define behavior
    t1.setStatePositions([1,2,3], [{x: 48, y:64},{x: 208, y:64},{x: 368, y:64}]);
    t1.setStateTransitions({1:2, 2:3, 3:1});

    t6.setStatePositions([12,13], [{x: 48, y:800},{x: 208, y:800}]);
    t6.setStateTransitions({12:13, 13:12});


    automa.stage.addChild(t1);
    automa.stage.addChild(t6);




</script>
</body>
</html>