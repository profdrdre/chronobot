<!DOCTYPE html>
<html>
<head>
    <script src="https://pixijs.download/release/pixi.min.js"></script>
</head>
<body>
<canvas id="mycanvas"></canvas>
<script>

    const size_normal=1,
        size_left=2,
        size_right=3;


    class Token extends PIXI.Container {


        constructor(texture, startState, x, y) {
            super()

            this.image = new PIXI.Sprite(texture);

            this.image.interactive = true;
            this.image.buttonMode = true;
            this.image.anchor = {x: .5, y:.5}
            this.x = x;
            this.y = y;

            this.addChild(this.image)

            this.image.on('pointerdown',this.advance)
            this.state = startState;
            this.steps = 30; // steps per animation
            this.size = size_normal;

            this.target = {x: 0, y:0};
            this.delta = {x: 0, y:0};
            this.imgtarget = {x: 0, y:0, scale :1};
            this.imgdelta = {x: 0, y:0, scale :0};


            this.statePositions = {};
            this.stateTransitions = {};


            this.tokenMover = () => {
                this.x += this.delta.x;
                this.y += this.delta.y;
                if (Math.abs(this.target.x - this.x) < Math.abs(this.delta.x) ||
                    Math.abs(this.target.y - this.y) < Math.abs(this.delta.y)) {
                    this.x = this.target.x;
                    this.y = this.target.y;
                    automa.ticker.remove(this.tokenMover);
                }
                //console.log("tick "+this.target.x.toString())
            }

            this.tokenResizer = () => {
                this.image.x += this.imgdelta.x;
                this.image.y += this.imgdelta.y;
                this.image.scale.x += this.imgdelta.scale;
                this.image.scale.y += this.imgdelta.scale;
                //console.log("tick");
                if (Math.abs(this.imgtarget.x - this.image.x) < Math.abs(this.imgdelta.x) ||
                    Math.abs(this.imgtarget.y - this.image.y) < Math.abs(this.imgdelta.y)) {
                    this.image.x = this.imgtarget.x;
                    this.image.y = this.imgtarget.y;
                    this.image.scale.x = this.imgtarget.scale;
                    this.image.scale.y = this.imgtarget.scale;
                    automa.ticker.remove(this.tokenResizer);
                }
                //console.log("tick "+this.target.x.toString())
            }



        }

        setStatePositions(states, positions) {
            states.forEach((value,index)=>{ this.statePositions[value]= positions[index];})
        }

        setStateTransitions(transitions) {
            this.stateTransitions = transitions;
        }

        resize(size){
            if (size==size_left && this.size!=size_left){
                this.imgtarget.x = -22;
                this.imgtarget.y = -22;
                this.imgtarget.scale = .7;
            }
            else if (size==size_right && this.size!=size_right){
                this.imgtarget.x = 22;
                this.imgtarget.y = 22;
                this.imgtarget.scale = .7;
            }
            else if (size==size_normal && this.size!=size_normal){
                this.imgtarget.x = 0;
                this.imgtarget.y = 0;
                this.imgtarget.scale = 1;
            }

            this.imgdelta.x = ((this.imgtarget.x - this.image.x) / this.steps);
            this.imgdelta.y = ((this.imgtarget.y - this.image.y) / this.steps);
            this.imgdelta.scale = ((this.imgtarget.scale - this.image.scale.x) / this.steps);

            automa.ticker.add(this.tokenResizer);

        }

        advance(){
            let container = this.parent;
            container.state = container.stateTransitions[container.state];
            container.target = container.statePositions[container.state];
            container.delta.x = ((container.target.x - container.x) / container.steps);
            container.delta.y = ((container.target.y - container.y) / container.steps);

            automa.ticker.add(container.tokenMover);

        }
    }

    const canvas = document.getElementById('mycanvas');

    const automa = new PIXI.Application({
        view: canvas,
        width: 1482,
        height: 1080,
        resolution: 1,
        autoDensity: true
    });

    const board_texture = PIXI.Texture.from('images/board.png');
    const board_img = new PIXI.Sprite(board_texture);
    board_img.x= 0 ;
    board_img.y = 0;
    automa.stage.addChild(board_img);

    const t1_texture = PIXI.Texture.from('images/t1.png');
    const t2_texture = PIXI.Texture.from('images/t2.png');
    const t3_texture = PIXI.Texture.from('images/t3.png');
    const t4_texture = PIXI.Texture.from('images/t4.png');
    const t5_texture = PIXI.Texture.from('images/t5.png');
    const t6_texture = PIXI.Texture.from('images/t6.png');




    const t1 = new Token(t1_texture, 1, 95, 112);
    const t2 = new Token(t2_texture, 5, 255, 464);
    const t3 = new Token(t3_texture, 7, 573, 464);
    const t4 = new Token(t4_texture, 8, 415, 625);
    const t5 = new Token(t5_texture, 11, 573, 625);
    const t6 = new Token(t6_texture, 12, 95, 848);


    // define behavior
    t1.setStatePositions([1,2,3], [{x: 95, y:112},{x: 254, y:112},{x: 415, y:112}]);
    t1.setStateTransitions({1:2, 2:3, 3:1});

    t2.setStatePositions([4,5,6,7,8,9,10], [{x: 95, y:464},{x: 255, y:464},{x: 415, y:464},{x: 573, y:464},
        {x: 415, y:625},{x: 255, y:625},{x: 95, y:625}]);
    t2.setStateTransitions({4:5, 5:6, 6:7, 7:8, 8:9, 9:10, 10:4});

    t3.setStatePositions([4,5,6,7,8,9,10], [{x: 95, y:464},{x: 255, y:464},{x: 415, y:464},{x: 573, y:464},
        {x: 415, y:625},{x: 255, y:625},{x: 95, y:625}]);
    t3.setStateTransitions({4:5, 5:6, 6:7, 7:8, 8:9, 9:10, 10:4});

    t4.setStatePositions([4,5,6,7,8,9,10], [{x: 95, y:464},{x: 255, y:464},{x: 415, y:464},{x: 573, y:464},
        {x: 415, y:625},{x: 255, y:625},{x: 95, y:625}]);
    t4.setStateTransitions({4:5, 5:6, 6:7, 7:8, 8:9, 9:10, 10:4});

    t5.setStatePositions([4,5,6,7,8,9,10,11], [{x: 95, y:464},{x: 255, y:464},{x: 415, y:464},{x: 573, y:464},
        {x: 415, y:625},{x: 255, y:625},{x: 95, y:625}, {x:573, y: 625}]);
    t5.setStateTransitions({4:5, 5:6, 6:7, 7:8, 8:9, 9:10, 10:4,11:8});



    t6.setStatePositions([12,13], [{x: 95, y:848},{x: 255, y:848}]);
    t6.setStateTransitions({12:13, 13:12});


    automa.stage.addChild(t1);
    automa.stage.addChild(t2);
    automa.stage.addChild(t3);
    automa.stage.addChild(t4);
    automa.stage.addChild(t5);
    automa.stage.addChild(t6);


 //   automa.stage.addChild(t6);




</script>
</body>
</html>